<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Our game</title>
    <script type="text/javascript" src="js/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1365 , 660, Phaser.AUTO, '');




//we create 5 gamestates.

var gameState1 = function(){
    console.log("gameState1");
};
gameState1.prototype = {
    preload : preload1,
    create : create1,
    update : update1
};

var gameState2 = function(){
    console.log("gameState2");
};
gameState2.prototype = {
    preload : preload2,
    create : create2,
    update : update2
};

var gameState3 = function(){
    console.log("gameState3");
};
gameState3.prototype = {
    preload : preload3,
    create : create3,
    update : update3
};

var gameState4 = function(){
    console.log("gameState4");
};
gameState4.prototype = {
    preload : preload4,
    create : create4,
    update : update4
};

var gameState5 = function(){
    console.log("gameState5");
};
gameState5.prototype = {
    preload : preload5,
    create : create5,
    update : update5
};






game.state.add('gameState1',gameState1);
game.state.add('gameState2',gameState2);
game.state.add('gameState3',gameState3);
game.state.add('gameState4',gameState4);
game.state.add('gameState5',gameState5);




//Gamestate1 start
game.state.start('gameState1');

function preload1(){
     game.load.image('button', 'assets/instructions1.png');
	 game.load.image('button', 'assets/button1.png');

var button;
var background;

}


function create1(){
game.stage.backgroundColor = '#182d4a';

    //background = game.add.tileSprite(0, 0, 800, 600, 'background');

    scoreText = game.add.text(game.world.width/2,game.world.height/2, 'Welcome !!!', { fontSize: '45px', fill: '#FFF' });
    scoreText.anchor.setTo(0.5,0.5);
    scoreText = game.add.text(game.world.width/2,game.world.height/2 + 42, 'Press arrow keys to proceed ', { fontSize: '45px', fill: '#FFF' });
    scoreText.anchor.setTo(0.5,0.5);

    cursors = game.input.keyboard.createCursorKeys();

//We create a button here
    button = game.add.button(game.world.centerX - 120, 450, 'button', actionOnClick, this);

    button.onInputOver.add(over, this);
    button.onInputOut.add(out, this);
    button.onInputUp.add(up, this);

}

function up() {
    console.log('button up', arguments);
}

function over() {
    console.log('button over');
}

function out() {
    console.log('button out');
}

function actionOnClick () {

    game.state.start('gameState5');
 
}


function update1(){

    if (cursors.left.isDown || cursors.right.isDown || cursors.up.isDown || cursors.down.isDown) {

         //game.state.stop('gameState1');
         game.state.start('gameState2');
    }

}




//Gamestate5 start

function preload5() {

     game.load.image('button1', 'assets/back.png');
     var button1;
}

function create5() {
    
 var Text2 = game.add.text(16, 16, 'INSTRUCTIONS:\n Dodge the bullets and collect the stars.\n Health increases by 10 when you collect a star and\n decreases by 10 when you touch a bullet.\n\n If Health = 200, you win\n and you lose when Health becomes 0. ', { fontSize: '30px', fill: '#FF9' });


//We create a button here
button1 = game.add.button(game.world.centerX - 95, 450, 'button1', actionOnClick1, this);

    button1.onInputOver.add(over, this);
    button1.onInputOut.add(out, this);
    button1.onInputUp.add(up, this);

}

function up() {
    console.log('button up1', arguments);
}

function over() {
    console.log('button over1');
}

function out() {
    console.log('button out1');
}

function actionOnClick1 () {

 //var scoreText = game.add.text(550, 330, 'Good game!!! ', { fontSize: '42px', fill: '#FFF' });
    game.state.start('gameState1');
 //background.visible =! background.visible;


}

//     function actionOnClick2 () {

    
//     //game.state.stop('gameState1');
//     game.state.start('gameState2');
 

// }

function update5(){

}



//Gamtate2 start
function preload2() {

    game.load.image('sky', 'assets/sky.png');
    game.load.image('horizontal', 'assets/shooth.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('shoot3', 'assets/shoot3.png');
    game.load.image('star', 'assets/star.png');
    //game.load.image('button', 'assets/buttons1.png');
    game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
    

}

var sky;
var player;
var platforms;
var cursors;
var seconds;
var minutes;
var shoot3;
var score = 100 ;
var scoreText;
var scoreText1;
var counter =0;
var text ;
var star;
var button;
var horizontal;
var spaceKey;


function create2() {

    game.physics.startSystem(Phaser.Physics.ARCADE);
    
    game.world.setBounds(0, 0, 1465, 950);

    //The background

     sky = game.add.sprite(0, 0, 'sky');
     sky.scale.setTo(10,2);






    // The player and its settings
    player = game.add.sprite(32, game.world.height - 500, 'dude');

    //  We need to enable physics on the player
    game.physics.arcade.enable(player);

    //  Player physics properties. Give the little guy a slight bounce.
    player.body.bounce.y = 0.2;
    player.body.gravity.y = 600;
    player.body.collideWorldBounds = true;

    //  Our two animations, walking left and right.

    player.animations.add('left', [0, 1, 2, 3], 10, true);
    player.animations.add('right', [5, 6, 7, 8], 10, true);
    

    player.body.fixedRotation = true;

    game.camera.follow(player, Phaser.Camera.FOLLOW_LOCKON, 0.1, 0.1);



    //The ground and ledges

      platforms = game.add.group();

      platforms.enableBody = true;

      var ground;
      ground = platforms.create(0, 942, 'ground');

      ground.scale.setTo(8, 1);
      ground.body.immovable = true;



    //  Now let's create ledges

    var ledge = platforms.create(0, 600, 'ground');
    ledge.body.immovable = true;  

    var ledge = platforms.create(520, 320*Math.random() + 230, 'ground');
    

    
     //  for(var n = 0 ;n <=5; n++)
     //   {
     //    var ledge = platforms.create(950*Math.random() + 300, 810*Math.random() + 500, 'ground');
     // ledge.body.immovable = true;  
        
     //   }

        for(var m = 0 ;m <0.5; m++)
       {
        setInterval(function(){ 
        var ledge = platforms.create(850*Math.random() + 300, 910*Math.random() + 400, 'ground');
        },2000);
        
       } 
   


    //Here we define bullets

    shoot3s = game.add.group();
    stars = game.add.group();

    //  We will enable physics for any shoot3 that is created in this group
    shoot3s.enableBody = true;
    stars.enableBody = true;
    scoreText.enableBody = true;
    

    //Here we create bullets

   for (var i = 0; i < 10; i++) {

       setInterval(function(){ 
        var shoot3 = shoot3s.create( game.world.randomX,0, 'shoot3');
     shoot3.body.gravity.y = 720;
 }, 2000);
   }

for(var b=0; b< 1;b++)
{
    setInterval(function(){ 
    var horizontal30 = shoot3s.create( 0 , 400*Math.random() + 650, 'horizontal');
     horizontal30.body.gravity.x= 300;
 }, 2000);
    
}

for(var b=0; b< 1;b++)
{
    setInterval(function(){ 
    var horizontal40 = shoot3s.create( 0 , 970*Math.random() + 300, 'horizontal');
     horizontal40.body.gravity.x= 300;
 }, 2000);
    
}




 //Here we create the stars

  for(var k=0;k<2;k++)
  {
  setInterval(function(){ 
        var star = stars.create(game.world.randomX , 0, 'star');
     star.body.gravity.y = 500;
    star.body.bounce.y = 1;
 }, 6000);
 
}
setInterval(function(){ 
        var star = stars.create(game.world.randomX , game.world.height, 'star');
     star.body.gravity.y = -600;
    star.body.bounce.y = 1;
 }, 6000);


//	setInterval(function(){ 
 //        var star = stars.create(game.world.randomX , game.world.height, 'star');
 //     star.body.gravity.y = -600;
 //    star.body.bounce.y = 1;
 // }, 6000);




//We add the texts 'Health' and 'Time'

 var s =scoreText = game.add.text(26, 16, 'Health: 100', { fontSize: '50px', fill: '#000' });
 s.fixedToCamera = true;
    s.cameraOffset.setTo(26, 16);

 var t =text = game.add.text(1100, 16, 'Time: 0', { font: "40px Arial", fill: "#ffffff", align: "center" });
    text.anchor.setTo(0, 0);
t.fixedToCamera = true;
    t.cameraOffset.setTo(1100, 16);





 //Here we create the timer   
     game.time.events.loop(Phaser.Timer.SECOND , updateCounter, this);

     function updateCounter() {

    counter++;

    text.setText('Time: ' + counter);

} 


    //  Our controls.
    cursors = game.input.keyboard.createCursorKeys();

     spaceKey = this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    spaceKey.onDown.add(togglePause, this);

}

function togglePause() {

    game.physics.arcade.isPaused = (game.physics.arcade.isPaused) ? false : true;

}



//Create new ledge after every 30 seconds.
game.time.events.repeat(Phaser.Timer.SECOND * 30, 10, createledge, this);



function createledge() {

   

    var ledge = game.add.sprite(game.world.randomX, game.world.randomY, 'ground');


    ledge.body.immovable=true;
    
}






function update2() {

    game.physics.arcade.collide(player, platforms);
    game.physics.arcade.collide(stars, platforms);

    game.physics.arcade.overlap(player ,shoot3s, killshoot3, touchshoot3, null, this);
    game.physics.arcade.overlap(player ,stars, touchstar, null, this);
   


    player.body.velocity.x = 0;


    if (cursors.left.isDown)
    {
        //  Move to the left
        player.body.velocity.x = -200;

        player.animations.play('left');
    }
    else if (cursors.right.isDown)
    {
        //  Move to the right
        player.body.velocity.x = 175;

        player.animations.play('right');
    }
    else
    {
        //  Stand still
        player.animations.stop();

        player.frame = 4;
    }
    
     //  Allow the player to jump if they are touching the ground.
    if (cursors.up.isDown && player.body.touching.down)
    {
        player.body.velocity.y = -600;
    }

    if (cursors.right.isDown) {
        scoreText.velocity = 150;
    }

    if (cursors.left.isDown) {
        scoreText.velocity = -150;
    }

    function touchshoot3 (player , shoot3){

        shoot3.kill();
        score -= 10;
        scoreText.text = 'Health: ' + score;
        
    }

   

    //Player collects star
    function touchstar(player , star){
        star.kill();
        score += 10;
        scoreText.text = 'Health : ' + score;
       
    }
    

    //Bullet touch player
    function killshoot3( platforms , shoot3){
        shoot3.kill();

    }


    if (score <= 0) {
        player.kill();

        game.state.start('gameState3');
    }

    else if (score >= 200) {
        player.kill();

        //game.state.stop('gameState2');
        game.state.start('gameState4');
    }

    
}




//Gamestate3 start
function preload3(){

    game.load.image('button1', 'assets/back.png');
     var button1;

}



function create3(){ 
    coreText = game.add.text(550, 330, 'Good game!!!\n Try again next time ', { fontSize: '42px', fill: '#FFF' });
    scoreText.anchor.setTo(0.5,0.5);

    button1 = game.add.button(game.world.centerX - 95, 450, 'button1', actionOnClick1, this);

    button1.onInputOver.add(over, this);
    button1.onInputOut.add(out, this);
    button1.onInputUp.add(up, this);

}

function up() {
    console.log('button up1', arguments);
}

function over() {
    console.log('button over1');
}

function out() {
    console.log('button out1');
}

function actionOnClick1 () {

 //var scoreText = game.add.text(550, 330, 'Good game!!! ', { fontSize: '42px', fill: '#FFF' });
    game.state.start('gameState1');
 //background.visible =! background.visible;





}


function update3(){
}





//Gamestate4 start
function preload4(){

var button1;
game.load.image('button1', 'assets/play_again.png');

}



function create4(){ 
    scoreText = game.add.text(600, 330, 'You win!!!', { fontSize: '42px', fill: '#FFF' });
    scoreText.anchor.setTo(0.5,0.5);


button1 = game.add.button(game.world.centerX - 95, 450, 'button1', actionOnClick1, this);

    button1.onInputOver.add(over, this);
    button1.onInputOut.add(out, this);
    button1.onInputUp.add(up, this);

}

function up() {
    console.log('button up1', arguments);
}

function over() {
    console.log('button over1');
}

function out() {
    console.log('button out1');
}

function actionOnClick1 () {

 //var scoreText = game.add.text(550, 330, 'Good game!!! ', { fontSize: '42px', fill: '#FFF' });
    game.state.start('gameState1');
 //background.visible =! background.visible;


}

//     function actionOnClick2 () {

    
//     //game.state.stop('gameState1');
//     game.state.start('gameState2');
 

// }





function update4(){

}


</script>

</body>
</html>